# Introduction
OpenCV 2.4 now comes with the very new FaceRecognizer class for face recognition。

The currently available algorithms are:

Eigenfaces (see createEigenFaceRecognizer())
Fisherfaces (see createFisherFaceRecognizer())
Local Binary Patterns Histograms (see createLBPHFaceRecognizer())


OpenCV 从 2.4 版本加入了一个 FaceRecognizer 类，用于人脸识别。

目前用于人脸识别的算法有如下三种：

* Eigenfaces
* Fisherfaces
* Local Binary Patterns Histograms

# Face Recognition
Automatic face recognition is all about extracting those meaningful features from an image, putting them into a useful representation and performing some kind of classification on them.


Face recognition based on the geometric features of a face is probably the most intuitive approach to face recognition. 

The recognition was performed by calculating the euclidean distance between feature vectors of a probe and reference image


feature vector 特征向量
euclidean distance 欧氏距离


# Eigenfaces
The problem with the image representation we are given is its high dimensionality. Two-dimensional p * q grayscale images span a m = pq-dimensional vector space, so an image with 100 * 100 pixels lies in a 10,000-dimensional image space already. The question is: Are all dimensions equally useful for us? We can only make a decision if there’s any variance in data, so what we are looking for are the components that account for most of the information. The Principal Component Analysis (PCA) was independently proposed by Karl Pearson (1901) and Harold Hotelling (1933) to turn a set of possibly correlated variables into a smaller set of uncorrelated variables. 

The idea is, that a high-dimensional dataset is often described by correlated variables and therefore only a few meaningful dimensions account for most of the information. The PCA method finds the directions with the greatest variance in the data, called principal components.

Principal Component Analysis (PCA)

上面这段话的意思是，一张图片有很多个像素点组成，但对于人脸识别而言，其中只有一小部分包含了用于人脸识别的绝大多数信息，Eigenfaces 的目的就是通过 PCA，找到这一小部分，在基于这一小部分，进行人脸识别。

# Fisherfaces
The Principal Component Analysis (PCA), which is the core of the Eigenfaces method, finds a linear combination of features that maximizes the total variance in data. While this is clearly a powerful way to represent data, it doesn't consider any classes and so a lot of discriminative information may be lost when throwing components away. Imagine a situation where the variance in your data is generated by an external source, let it be the light. The components identified by a PCA do not necessarily contain any discriminative information at all, so the projected samples are smeared together and a classification becomes impossible (see http://www.bytefish.de/wiki/pca_lda_with_gnu_octave for an example).

The Linear Discriminant Analysis performs a class-specific dimensionality reduction and was invented by the great statistician Sir R. A. Fisher. He successfully used it for classifying flowers in his 1936 paper The use of multiple measurements in taxonomic problems [54] . In order to find the combination of features that separates best between classes the Linear Discriminant Analysis maximizes the ratio of between-classes to within-classes scatter, instead of maximizing the overall scatter. The idea is simple: same classes should cluster tightly together, while different classes are as far away as possible from each other in the lower-dimensional representation. This was also recognized by Belhumeur, Hespanha and Kriegman and so they applied a Discriminant Analysis to face recognition in [11] .

首先分析了 PCA 的缺点，并举了一个例子说明 PCA 很受光照的影响。

然后，阐述了 Linear Discriminant Analysis 的基本思路。


# 总结
目前，opencv 提供的人脸识别算法有人如下三种：

1. Eigenfaces
2. Fisherfaces
3. Local Binary Patterns Histograms

三种算法各有各的优缺点，比如 Eigenfaces 非常容易受光照影响。

然后，相对于目前的最新的人脸识别技术，opencv 提供的这几种算法已经落后了很多。然后也有免费的商用API 服务：

    https://www.faceplusplus.com.cn/pricing/

就咱们的需求来讲，用 opencv 应该就够了，然后下面的重点就是制作训练集（明星的照片），然后测试，调整算法的一些参数。

下阶段任务：

1. 把示例代码摸透，根据示例代码和现有人脸数据库，做出程序原型
2. 制作训练集
3. 测试，调整参数

下一步，可以制作我们自己的训练集了，除了搜集照片，其次要涉及的问题，就是对照片中人脸的识别和剪裁，然后对图片进行灰化处理

明天先写个爬虫，把数据爬了


第一步，获取一个要抓取的明星列表，这个存放到文件里，一行一个。

    http://top.baidu.com/buzz?b=618&c=9&fr=topbuzz_b15_c9

    _.each($('td.keyword a:even'), function(e) { 
        var info = e.innerText + ';' + encodeURI(e.innerText);
        console.log(info);
    })

这一步，后面可以结合百度风云榜的各个榜单，生成一个明星列表，主要是处理一些重复的情况，然后排除一些人名，比如彭丽媛，还要一些非人名、比如 tfboy

第二步，基于 CEF，获取加载完成后的网页
    在抓取章子怡、韩雪、陈龙这三个人的网页时，抓取的数据不对，页面状态变化也不会；然后也不一定是这3个人，刚才单独试了下林志玲，也是这样，但之前就没出现过这种情况。后面好好研究下。

正常状态：
    Loading
    OnLoadStart
    OnLoadEnd
    Loading end

异常状态：
    Loading
    OnLoadStart
    OnLoadEnd
    Loading end
    Loading
    Loading end

第三步，用 C++ 解析，然后获取图片链接、并保存图片，或者用 NODEJS 解析，获取图片链接，并保存图片

    这一步，目前的使用的是 nodejs 完成，但程序也有问题，主要是异步上的处理。我回头还是想用 C++ 处理。
    

第四步，基于人脸识别程序，对照片进行筛选，标准如下：

    1. 能识别出人脸、眼睛、嘴巴
    2. 分辨率在 200 x 200 以上

    其他标准，还需要在考虑，总之，筛选出来的照片应该尽量都是在正脸照。

然后筛选出的图片进行剪裁、缩放、灰化处理


第六步，从筛选出的照片中每人选择 5 张，作为训练数据，其他作为测试数据；


目前，50人，每人5张照片作为训练集，分辨率都为150 x 150，然后另外取5张作为测试，3种算法，准确率都低的惊人。然后 eigenfaces 算法，后面可以先不考虑，同样的训练集，eigenfaces 生成的训练数据比另外两者大了5倍，识别速度也慢。

下一步，怎么弄呢？

1. 提高训练集数量
2. 用 opencv 提供的示例程序试下
    以 lbph 算法为例，测试结果和我们自己的程序一样

目前来看，准确率就这样，提高训练集的数量，效果也一般。我想下一步，对算法在了解了解，比如什么是 confidence

# 什么是 confidence 
confidence 是指识别算法用来衡量识别准确度的一种变量，不同的识别算法，使用的变量不一定相同。

其中 euclidean distance（欧氏距离）就是其中的一种变量，至于 lbph 使用的是否是欧氏距离，不清楚，但在人脸识别这块，应该是欧氏距离越小，说明两张图片越匹配。


[1]: https://docs.opencv.org/3.0-beta/modules/face/doc/facerec/facerec_tutorial.html "Face Recognition with OpenCV"
[2]: https://github.com/opencv/opencv_contrib "opencv_contrib"
[3]: https://wenku.baidu.com/view/859c41252f60ddccda38a0d6.html "基于图像欧氏距离的人脸描述和识别方法"